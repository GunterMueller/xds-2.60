<* M2EXTENSIONS + *>
<* CHECKRANGE - *>
<* IOVERFLOW - *>
<* COVERFLOW - *>

IMPLEMENTATION MODULE OS2RTL;

IMPORT OS2;

FROM SYSTEM IMPORT CAST;

(* PMGPI.H *)
   -------

<* IF __GEN_X86__ THEN *>

PROCEDURE ["SysCall"] MAKEFIXED(intpart : OS2.SHORT; fractpart: OS2.USHORT) : OS2.FIXED;
BEGIN
  RETURN  VAL(OS2.LONG,intpart) * 10000H + VAL(OS2.LONG, fractpart);
END MAKEFIXED;

PROCEDURE ["SysCall"] FIXEDFRAC(fx : OS2.FIXED) : OS2.USHORT;
BEGIN
  RETURN CAST(OS2.ULONG,fx) MOD 10000H;
END FIXEDFRAC;

PROCEDURE ["SysCall"] FIXEDINT (fx : OS2.FIXED) : OS2.SHORT;
BEGIN
  RETURN fx DIV 10000H;
END FIXEDINT;

<* END *> (* __GEN_X86__ *)

(* PMWIN.H *)
   -------

<* IF __GEN_X86__ THEN *>

PROCEDURE ["SysCall"] MPFROMHWND (hwnd : OS2.HWND) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, hwnd);
END MPFROMHWND;

PROCEDURE ["SysCall"] MPFROMCHAR (ch : CHAR) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, VAL(OS2.ULONG, ch));
END MPFROMCHAR;

PROCEDURE ["SysCall"] MPFROMSHORT (s : OS2.SHORT) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, VAL(OS2.LONG, s));
END MPFROMSHORT;

PROCEDURE ["SysCall"] MPFROM2SHORT (s1, s2 : OS2.SHORT) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, VAL(OS2.LONG,s1)+VAL(OS2.LONG,s2) * 10000H);
END MPFROM2SHORT;

PROCEDURE ["SysCall"] MPFROMSH2CH (s: OS2.SHORT; uch1, uch2 : CHAR) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, CAST(OS2.ULONG,VAL(OS2.LONG,s))+VAL(OS2.ULONG,uch1)*10000H+VAL(OS2.ULONG,uch2)*1000000H);
END MPFROMSH2CH;

PROCEDURE ["SysCall"] MPFROMLONG (l : OS2.LONG) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, l);
END MPFROMLONG;


PROCEDURE ["SysCall"] HWNDFROMMP (mp : OS2.MPARAM) : OS2.HWND;
BEGIN
  RETURN CAST(OS2.HWND, mp);
END HWNDFROMMP;

PROCEDURE ["SysCall"] CHAR1FROMMP (mp : OS2.MPARAM) : CHAR;
BEGIN
  RETURN CAST(CHAR,CAST(OS2.ULONG,mp) MOD 100H);
END CHAR1FROMMP;

PROCEDURE ["SysCall"] CHAR2FROMMP (mp : OS2.MPARAM) : CHAR;
BEGIN
  RETURN CAST(CHAR,(CAST(OS2.ULONG,mp) DIV 100H) MOD 100H);
END CHAR2FROMMP;

PROCEDURE ["SysCall"] CHAR3FROMMP (mp : OS2.MPARAM) : CHAR;
BEGIN
  RETURN CAST(CHAR,(CAST(OS2.ULONG,mp) DIV 10000H) MOD 100H);
END CHAR3FROMMP;

PROCEDURE ["SysCall"] CHAR4FROMMP (mp : OS2.MPARAM) : CHAR;
BEGIN
  RETURN CAST(CHAR,CAST(OS2.ULONG,mp) DIV 1000000H);
END CHAR4FROMMP;

PROCEDURE ["SysCall"] SHORT1FROMMP (mp : OS2.MPARAM) : OS2.SHORT;
BEGIN
  RETURN VAL(OS2.SHORT,CAST(OS2.LONG,mp) MOD 10000H);
END SHORT1FROMMP;

PROCEDURE ["SysCall"] SHORT2FROMMP (mp : OS2.MPARAM) : OS2.SHORT;
BEGIN
  RETURN VAL(OS2.SHORT,CAST(OS2.LONG,mp) DIV 10000H);
END SHORT2FROMMP;

PROCEDURE ["SysCall"] LONGFROMMP (mp : OS2.MPARAM) : OS2.LONG;
BEGIN
  RETURN CAST(OS2.LONG,mp);
END LONGFROMMP;


PROCEDURE ["SysCall"] MRFROMSHORT (s : OS2.SHORT) : OS2.MRESULT;
BEGIN
  RETURN CAST(OS2.MRESULT,VAL(OS2.LONG,s));
END MRFROMSHORT;

PROCEDURE ["SysCall"] MRFROM2SHORT (s1, s2 : OS2.SHORT) : OS2.MRESULT;
BEGIN
  RETURN CAST(OS2.MRESULT,VAL(OS2.LONG,s1)+VAL(OS2.LONG,s2)*10000H);
END MRFROM2SHORT;

PROCEDURE ["SysCall"] MRFROMLONG (l : OS2.LONG) : OS2.MRESULT;
BEGIN
  RETURN CAST(OS2.MRESULT,l);
END MRFROMLONG;


PROCEDURE ["SysCall"] SHORT1FROMMR (mr : OS2.MRESULT) : OS2.SHORT;
BEGIN
  RETURN VAL(OS2.SHORT,CAST(OS2.LONG,mr) MOD 10000H);
END SHORT1FROMMR;

PROCEDURE ["SysCall"] SHORT2FROMMR (mr : OS2.MRESULT) : OS2.SHORT;
BEGIN
  RETURN VAL(OS2.SHORT,CAST(OS2.LONG,mr) DIV 10000H);
END SHORT2FROMMR;

PROCEDURE ["SysCall"] LONGFROMMR (mr : OS2.MRESULT) : OS2.LONG;
BEGIN
  RETURN CAST(OS2.LONG,mr);
END LONGFROMMR;

<* END *> (* __GEN_X86__ *)

(***** Extra "macros" *************************************************)

PROCEDURE ["SysCall"] MPFROMUSHORT (us : OS2.USHORT) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, VAL(OS2.ULONG, us));
END MPFROMUSHORT;

PROCEDURE ["SysCall"] MPFROM2USHORT(us1, us2 : OS2.USHORT) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, VAL(OS2.ULONG,us1)+VAL(OS2.ULONG,us2) * 10000H);
END MPFROM2USHORT;

PROCEDURE ["SysCall"] MPFROMULONG (ul : OS2.ULONG) : OS2.MPARAM;
BEGIN
  RETURN CAST(OS2.MPARAM, ul);
END MPFROMULONG;


PROCEDURE ["SysCall"] USHORT1FROMMP(mp : OS2.MPARAM) : OS2.USHORT;
BEGIN
  RETURN VAL(OS2.USHORT,CAST(OS2.ULONG,mp) MOD 10000H);
END USHORT1FROMMP;

PROCEDURE ["SysCall"] USHORT2FROMMP(mp : OS2.MPARAM) : OS2.USHORT;
BEGIN
  RETURN VAL(OS2.USHORT,CAST(OS2.ULONG,mp) DIV 10000H);
END USHORT2FROMMP;

PROCEDURE ["SysCall"] ULONGFROMMP (mp : OS2.MPARAM) : OS2.ULONG;
BEGIN
  RETURN CAST(OS2.ULONG,mp);
END ULONGFROMMP;


PROCEDURE ["SysCall"] MRFROMUSHORT (us : OS2.USHORT) : OS2.MRESULT;
BEGIN
  RETURN CAST(OS2.MRESULT,VAL(OS2.ULONG,us));
END MRFROMUSHORT;

PROCEDURE ["SysCall"] MRFROM2USHORT(us1, us2 : OS2.USHORT) : OS2.MRESULT;
BEGIN
  RETURN CAST(OS2.MRESULT,VAL(OS2.ULONG,us1)+VAL(OS2.ULONG,us2)*10000H);
END MRFROM2USHORT;

PROCEDURE ["SysCall"] MRFROMULONG (ul : OS2.ULONG) : OS2.MRESULT;
BEGIN
  RETURN CAST(OS2.MRESULT,ul);
END MRFROMULONG;


PROCEDURE ["SysCall"] USHORT1FROMMR(mr : OS2.MRESULT) : OS2.USHORT;
BEGIN
  RETURN VAL(OS2.USHORT,CAST(OS2.ULONG,mr) MOD 10000H);
END USHORT1FROMMR;

PROCEDURE ["SysCall"] USHORT2FROMMR(mr : OS2.MRESULT) : OS2.USHORT;
BEGIN
  RETURN VAL(OS2.USHORT,CAST(OS2.ULONG,mr) DIV 10000H);
END USHORT2FROMMR;

PROCEDURE ["SysCall"] ULONGFROMMR (mr : OS2.MRESULT) : OS2.ULONG;
BEGIN
  RETURN CAST(OS2.ULONG,mr);
END ULONGFROMMR;


END OS2RTL.
